class Api::RestaurantsController < ApplicationController
  before_action :set_google_places_client, only: [:index, :restaurant_details]

  def index
    return render_error(:bad_request, '位置情報が提供されていません') if params[:latitude].blank? || params[:longitude].blank?

    begin
      restaurants = fetch_restaurants_from_google
    rescue => e
      return render_error(:bad_request, e.message)
    end

    if params[:price].present?
      selected_levels = params[:price].map(&:to_i)
      restaurants = restaurants.select { |restaurant| selected_levels.include?(restaurant.price_level.to_i) }
      return render_error(:bad_request, 'レストランが見つかりません。検索条件を変更して再度お試しください。') if restaurants.blank?
    end

    restaurants = restaurants.select do |restaurant|
      distance_in_meters(restaurant.lat, restaurant.lng, params[:latitude].to_f, params[:longitude].to_f) <= params[:radius].to_i
    end
    return render_error(:bad_request, 'レストランが見つかりません。検索条件を変更して再度お試しください。') if restaurants.blank?

    processed_restaurants = sort_restaurants(process_restaurant_data(restaurants)).reverse

    # テスト用レストランデータ
    # processed_restaurants = [{"place_id":"ChIJ1VhtH3z1GGARy6QlgNreb-0","name":"トラットリア ピッツェリア カノア","lat":35.5717072,"lng":139.6555605,"vicinity":"川崎市中原区今井南町２０−５７４ 森ビル1F","rating":3.9,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqE0BJoXXytVhanKLn1V8XYnnkkaf9Ea-NEudF3zQ4VZ95kFi-18bX1QR3Gk9canbwMksDvrcnZ30NWyyd-VIBKngDQE8OxPUb0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGj_HZ9uszjbd5FWCEH_cPu8MbwVgxXbFinBi8ge51K5UwBz-y4JNDyALoP1lw_J2ywdqaPZ-X_t1LeNA60Y6tSjMUA8UfMFsI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF77D8aAtzxYzr_-7_qYEp7qlfGjEm_K7uTZRMKNuxveba7sDyNl1drKij0jLnZ-IgTTc6rbVVbqsbDEW8C0PyDAcc3D1YDxyM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEmXaHnT4DCQwftGFjtfXsBdPTgMP8xv1QJT232K3SCaoy6vPKEJiOwIeGteykPEunU0pDssnza_iplCCRLaEO4pnMh2fI9fOk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGN7Km4tdPwHxYCW40tiomVZKIW6LUOGIoo1o1kk1u7JCIQIbG5ZqJf0oPm_yOSLUcHRMIM0_RWSliqbTWVjwbtPNEsRUIZuDs=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqElj58DAf9xfbzMW7T4N9ACq3Is6H8kV9n_tWmel4a5co10nwbKseAFynoSeMX1bC2GWV1jAzJMx8D9mbvnY43RkWRDVPlh9w0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEBkGJQLw7AqFcstu4pqyQDGZSydYOBQIeicvBJ0gG4Pb6-FFXjhmKoQGIi6OsZFHJlEIeOkEMDyYphQiEGLN3ONOTvK-zh8ws=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFOPFXyAOmuVWXmlKxMBGrChvakLhmrP-LZBPKrR6ibRYpZKTDeuFeAOz_WH9kWP3wAj8SG5vWf8J_7uwtFld24BkjB1_gy_kA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGrgjvFniiP-unTOH0usu2x_gW39x14YTUJnan_dBMFnZBpccUt3pQJEqOVJrQDFs89FS1IHSfdWd7U8Fu1ih4CyGjjjWrl1tE=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF9aJCZuxiMDVzkajO7kaa5gW4K7Lqzupj_EW3WQObU9xqUpAtAgAeq3qY3uiIW9h0LEjHHFuxmF2aJfNDVjvDd-ruaCpCOnvI=s1600-w800"],"website":"http://canoa-ro.com/","url":"https://maps.google.com/?cid=17109138539437991115","postal_code":"211-0064","user_ratings_total":127,"formatted_phone_number":"044-739-2771"},{"place_id":"ChIJD2MIGYBfGGARFwyZ5ZbkUak","name":"オステリアボッカーノ","lat":35.565265,"lng":139.65078,"vicinity":"川崎市中原区木月３丁目１７−１６ 荒井ビル B1","rating":4.2,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqFysrCgFsBe5fhQNQVXuLuTSYIYyGw-EWX51u94jMpYFD7iA0dKVr03-ughY3dDGm_UntJzj7T4q95mMPDCq6Wo1IHlhN8NUiM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFES4ZE6lUtdhDST8LKGpNQNqwvuXKAuSjxWzVnSOJD4O96tu06cXrDe3vqA9eWLpfRVK5m38C_EdLVepb__KMMooc67cxvGtI=s1600-w750","https://lh3.googleusercontent.com/places/ANXAkqHG2lrlhcndpbnb9RDtcB8paLUQ2fLf25uun98ciZ1KrcT01eMSwDF-rt5y_QJv9_y-E5G3BC6ggotQQPQromqmojcdGyK5waY=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGFZOyuXRo5_13o_MljaWneW8BG_HdG3YuIk_9GiS1rAAgbK8XsfDZZ8293TV2PYcjMdMYB8HWLocUD8oVx5tIK0hRcukF7wQk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqG8JQIs5TroQhuSHldXNK-X2RXGD88AnaL9qSvEhOLrNN-iiqsL1HwZkVoC3lE3ryUAG4Ev3KYybvBL0V4xy9Jn1bkmnNXkHTk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGsnH3QkaTSEPD9QOQoTTrCn4nYeAFHgumaG-xxu7zivY0GdYv0vw_oeqLKIG59iL9jyXAkKNj9xeXxxh6vxPQq_rkTVHPgvjU=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEbpm7wcSo3GNpLtd4tZrgkQlAkcpr6FK7hJdPKVHsMx724BzN3gHoCqTSrqAKR4htf68SH-SoyphIj-IjYj9LTDyVyWqMSNm8=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqE-FodWuKLzZs1l5sE_Nim1Ih0ouzyLyIBvO5SHch8Td4jeDaNR2etag5S__M3QfAK_mKdU3lhEwFZwMBd-gifX-40Pb7Dwlb0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFo0f0iZyo3x2ptZbIO_zoM9n1u3kke2s8iJUp67010MmqczctI1BvvQ5frJjXg5mQ7xI_bXOYdW9tJQ3rwZmRw8sVSAq_x_yk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqH6o4NXiB3_Sn6ToVvIZ5RUlJhG112iJMiCCiIulAdms7R8kmvQTm5DK8Z9OpXbg4ur8rJV_GWlDvGnj9wVi_zhBCXjMCWl1Mo=s1600-w800"],"website":"https://r.gnavi.co.jp/gd0jnstv0000/","url":"https://maps.google.com/?cid=12200784202271624215","postal_code":"211-0025","user_ratings_total":126,"formatted_phone_number":"044-411-1003"},{"place_id":"ChIJQxzwk4ZfGGARlVKY0O7vlzw","name":"Casa Bale カーサバーレ","lat":35.5650593,"lng":139.6570286,"vicinity":"川崎市中原区木月住吉町１１−４４","rating":4.2,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqHSEHztJuHGCs_xUWcgxTkfAMo7AbE9IfsiP6tp79QVUO4i7-nb6za_bG6tmE6U4O7rxYFbim0YPfSVdYH7hoEmuh4t4-ixLew=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHR6jYLFrw7QowHBLecINq-OrfpDjxCHUG-gwajFAJAYpxXFaRD88YwNMNWFbtzzIHV79N261akG6xW2LMLKHiSUmLciAMMt_4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFHYIsQvEIh-b_e7w61hCAFC9lXHPHIqoo9amxlOQMRM9cdGZezCf-N_VUY_wVfm3jJa228g93vV5MyC9y0lpONBN3is9nJGf4=s1600-w750","https://lh3.googleusercontent.com/places/ANXAkqELvL1b1yKb4IDMBF5T_IJhrjvxd-9NGI75lLE4WMQuomAa51k7_AUD7co_cU3GVtcD1g0keaY6kzPD-mlCzFQT5acnVxWxCY8=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGILJIGvHI7q-pwJ-MBJqSWYWLKNknFZc3IHr-BYjdlf6hOeQSwtwVm_rGgxkVBkO3-LstWVPv5vK--m796HcE0eNO4frw4opk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFCtMR7W2leRRnlxNFEZn11S6KQKnPvS6NleAIt_t659PsrNliuuIhfB-ft01xo-e6c3VqR1wzUT8rZR16OLRhPwjIIjNagago=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHACq6jLWixSrv9xwV4T3xgkbxfy8Q5Lw6_KCFclnehruBkYNmIxqmzn6PTPvWAnnepHPB3ybXeOBf2_-jPp_HMT1SL25pj5sg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEnExWM6FCL3ViUOzT6OZ86zV59uZQqhag1sw-OyQGEYm7sw3ZfWapMsvjQ3vhhNUP2fzk1ogJOjk1kKBgclXqJS0YESv4okfA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFf9VpFeGBowQ5cXu-QuLCS8vDBlJkFHZ8b0HykVwXelIbl_-6xgnR9sT_r7aCmDt4xv080MSBIgKF2Jmtj2B6U6rvf4-pIlEM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqH3g0BNW3-2asYNUF-Iez8DbfEuvRgI2l6VkvYaESeRaJ4PMFEwC-o3lnbRg_0ybIrCJ1LaVzdpFtMRNyj8Enms8J-tkgJEFJg=s1600-w800"],"website":"https://s.tabelog.com/kanagawa/A1405/A140504/14066263/","url":"https://maps.google.com/?cid=4366222172739883669","postal_code":"211-0021","user_ratings_total":52,"formatted_phone_number":"044-820-6455"},{"place_id":"ChIJIwjhEoBfGGARw7YcDK1yqy8","name":"binwan ビンワン 元住吉店","lat":35.5658418,"lng":139.651526,"vicinity":"川崎市中原区木月１丁目２９−１２","rating":3.8,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqH47R0GUEDHVPLCbd_IKxWHxq5i70rc09CoOSfSH1SLO_c1Z71AXm9Y4VZdO-3pJ8awacmsaNjThbAlptjiE3l-OaK9cIjfxsc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHbPtgN19a97Z71YutbzEYNjvySdfGJy76Hmfvlp-FSvB_8CguGOzmCHOWn9dFrbAS2BEUPjcLnj9BeVu6__LY1BAz44RwgfRo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFh6CPvEKnXm1MUNS3W4Eqr9Mm0iNwaZ5pu04O85WPfV84RoYWk-LFWSVi3eU-VEpHVssR0sdAge0cmx-O9DlDwO5HSf73-Pcg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF18zNE2LaLw_WHmEnmGXE7xqNU1DULL0A7TcgFBGzLtI6a8RLHQYWStqizXrcwK3Y3JNbZVDuA3gLHNRJrOovcVhNJGc7K2iA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqG65b6LM3NMEak1pGXQg0xfV0nIF7E-uEtHoJoJRBoSgEcj1DKQMwEdgoW4Oqvwwqi6lg0Aa5FxFPTxmh0ZjAJRB-AKtMZVzQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFRYXp7AHVbfRsJWi1LljTSEru9R-eveqd0j2eOLyQzKIDmof4Vjfn1tKIO4xHLX_CJJqOaSL-cMYrXnHKo9H1KhYUcVCL0Xg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHW9CFvkDWdNd4RWSsoFfQZ3xRL2u39rqhXmgIgyfLHN9c0mUTRfk2mRRxH5XEpLn_JNmGD1Qe46NO3J-RjLXCuzlm0_R0mWug=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHqhicSINFef0qF7ASbpfEBzdJUqs3huqGn2bsKb5OPSigJdH9O5QJ_nKfaV4xH9kmlV_HZxeaGElQdYCAA07BDJM4qNdfCNNk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqG9lsDMym_MKNOI5Lm01qBpqDeGwpK1j1KbxGXPSVisXd1v3rHLmplxIoTDxJGUj_5WBhaMM2wMFcjytbK7CKfEbnKLbMAaK1I=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqE_tKMq7KP1QTP8F8aBJrWLX367VPO7rMllnXBmI9O3GqXrdTjX_f5w9igbYTDVTlikmp8MNCI2VJ-wYqNwUWOUst3uvIZ9X0s=s1600-w800"],"website":"https://tabelog.com/kanagawa/A1405/A140504/14057655/","url":"https://maps.google.com/?cid=3434965228358252227","postal_code":"211-0025","user_ratings_total":211,"formatted_phone_number":"044-948-6954"},{"place_id":"ChIJcxVd4IBfGGARusYOZqsNMQs","name":"タヴェルナ フリコ","lat":35.5653747,"lng":139.6540267,"vicinity":"川崎市中原区木月１丁目２１−１１ 矢作ビル","rating":3.8,"price_level":nil,"photos":["https://lh3.googleusercontent.com/places/ANXAkqE55kVRoM6boguHJAmbJehdAVXkEPnKkWDbu6n8BTTmrCNZrkUeKimDf8BOxlqpKbJjCzXyGeQY0MqTVz-vwQiAT5o5zN3aBm4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEpHeb5ZnwVn-Uu_7SGCJ0D7s_GIS4dN-861w13lbzvzXZkTSd-h3zez7o5fdsPwU8c_5FuToLrd5bmSOxolLT7ubu_g-oc-Lk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEi90LCDvRCsZIzffmptHmX1iCJKX5bHJbywBIGKYkED2XNb9cWydFhJ9t9QDXKavu75nDuy7verpg1PYHlGqZl5YYfgJTAoog=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEKeKfQBRE2FJtx2vtKenbjpm4s58H5PTCom4nsTZJhVP1xf6gfWn7J8P0_YYItlgysMhY5T8J_4kz1s2VB-dHT3c_WHYFeBiI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqENhpMc-eWSotVCLOIXvZ1XcQ3N-LndW8OIedysd7g_9RopI5U3xU_7E6m8LYY9_DdOBmgyty37ILw7vFPs5NRCWqHtrIRNgyo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHyTrdk9FEBZHut5Vajk6Xd_VRiySosqIDHCqHVTdXq-doOqVeFOw2ujD3iGbkcoNN3QU0qR3zMWntEM7cFu5tExPpVzP9zWc4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEPa78ubukEwucXDVJPh6UrraOceoZzwq6UpJI7T7HeVuIEHFznOJrjId7skBT1XvZE7MtYdb9oyX5YxUr7fxhZ-X1RpYAE3Pk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHtBxGnUUNNKZ2s-UZKyG-XMBcmIN2Ca2emT-JntfpF0L1qNjHX-kYLlMjMc6FzGoDgUL4YWbYQhXcMZHN1V-Owp4c7zVmKDMI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFw3Gorwo6U1PIrmCyaUTNVW7ernJTGtK0PkQJgBLV_03xXy47L5cExeCpAn9fs5aol727Vw0V5SjnoYW8pL5mIN0L9A3XGbSU=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHnHO_3z59wgjL4eq-pWP5XmtwednmrKXrsO2rFeYAl8jLkjPHaNZIlfm-Ies-HsuDje6-ZiyfUt2dudpLGK2N7ZyOWf5Wev6A=s1600-w800"],"website":"https://frico0301.jp/","url":"https://maps.google.com/?cid=806440838078842554","postal_code":"211-0025","user_ratings_total":70,"formatted_phone_number":"044-422-9545"},{"place_id":"ChIJubCrioZfGGAR3G1SDtIJ0bw","name":"ラツィオ","lat":35.565656,"lng":139.6580012,"vicinity":"川崎市中原区木月住吉町９−６","rating":4.4,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqF1olLULW8ujNanyWwV7FF2rEI70ju2qUHynQQxcKlVvwzB_BQvDEb6K17uZ5TL0pYRlgeL3nql0qcDLSYatThTXeH8F5svsY0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqH_1GQg63s4WmVo_cZsmIr9NJF7oeJ4pAK3g7dPnH7-uwiZe_2govGm077Ld1IlyJ45dJXzqxsPmIWAj1A0V75Ae6pt-E7rLTA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFLco_4zZ14q_Zc4Zw5dZ1DRGJM6K6u28ezH-q5W_fA5C8NIfaVVhA_MpZnnPzAyPga_N9wqjlqj4Bt47XwtHjdQxg6B7KRlxA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqH6gw9_yBnpXjtsGeghV-7mNPWDIOO_dRrd0RrQkCccdu7d0vKwdelSof6P73-mQdVrlqcm535NFCrpH_SQWSy1AFiZFV-x8Jk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF8qi_2B5uMvAw3vCdGTnXnw9TpSYhyuaEELSmF4hTa1RBdPb4UeVMQWaDkKA86SSKDk0VlfJ716z3Nv7tkFJ_m35NAeUM1xCo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGJc8elJZUNF6lxwkJnVijfM8E5C7pj-Yl2r5AlOCxy-4unlgxhkcc6rPHMkaViXzzRXvkDtTo44OADKFJHdZSU5R-CdC7qrP0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEFWKCIsO3ayLVA1nu6bclA_lCwbR8XLm8WzGD4J033tdEFfh_M_uzN6CRh34GC9La1Y0DtRSmhL5dwQu2Xu4voEZaLooGX6BQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFuQzZ7gJgzSfdDPbNBhI476bNQde1T7a42N1WLCDYO3YMKoleCeDc1RjPRBDg1Lc0EKrdMf3Qmpnnr7xVDtFJEjIZLG5deEB4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEwZUluetqMHVENAumpqn44EvLs0ycrVV-Yvf116oMlOQjZldSGqzRn6V-WKt8zi9XdkDdJMS5p1ea8IIa3pOQW9QKhjH2AgmQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHwQC7Vu7r-B-46XLA6jFDYIa7FwEnnii_qGJSeiCr-EG0FfddVzKe9gcKkn7M09TFchPdcTWigp7pMdVUmSlCoY3PI3bRnNsI=s1600-w800"],"website":nil,"url":"https://maps.google.com/?cid=13605666747051044316","postal_code":"211-0021","user_ratings_total":80,"formatted_phone_number":"044-422-7027"},{"place_id":"ChIJeXud-YBfGGARYrQ5Z-iP09U","name":"NINE 元住吉店","lat":35.5647101,"lng":139.6525539,"vicinity":"川崎市中原区木月１丁目３２−１１ 1F南 日生ハイツ","rating":4.5,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqGAS5zbmU3n242ZT2ZQlFj_Bksi0gSl0LqrO0K5--uvkdU3gZ0cufxr6gWdwV6kCCzcZ4tJy-rl_1Ek6jMGgJLj1IuYSUY4dII=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGkROxqlNhvRamVg4na4zH3_CWTiSRmWgebBPiReEJUaejIfXQ-RdppaPgNHiHXe-cUIe_DxgpwB0XcfPZRnj1eo_7Rmbm48jQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGsjNi_bdyh2NrDXVU20M_EGdoseHc-b7FM-uQAKQbgg9-dFJ1434nsHi5cwDGpk6rPhF4bz4_K4s2e1JmJRC0kdWvNTId4l6A=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGqsGPmRfbM88iqYj2PZqMskClHzFvnfnEpYCt6pYeDNUVOPMHzp5lv4oJ-5akIxGGpcw-2cmCH0tqQQqpQ2q3ZsXe7HYTDMGA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGwTgpZi2jRMRoA0gqL7Rd603O7LCm4o4qtcuNJB8CKTq8LHb0kzeOMlQVhuyRS7ipnOnqJqlL5pNUZB4PPynTLkBXGhTqi0YQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEK6aidEQ9j_zW8vGKawQMuycN8PHnwbnpJnNkU1I1Sm6gyRHdBhAzFoJBaMmj8WJiEgAasTgviQdf3UhOQCGSBQUivkNHuTjU=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFZ34Dx-U4xwk3KH_Qm-NXyl98nnCF4GfsTvCpC0JrbHnRgxkDWEjQbewp4jeuafZSoRmP_fSXpcVtELXguTnBVhc7tG2kUnqA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGC1abaivq7k-_MjDWC2pYgbvwrHr6BP3gt_iatPlbLDwDh2XeM7Yamj0cM3j0VYv273oMquvQAhl2TIZK2tVTkpso0Jk9sV78=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEWDWcOYMXIZUTx00UgvtY0iiQwWx_4prQHu9l79I8m0QKZPbJnoAeEQZk7Dl0Y-HOkdwJmNQKFu8zF-OiU5GPPOkqv0Xkvl9c=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEHnmXvcVSoPenIeQm77NGKlkddkGiS08MMh-Jle39HNdFlYGkqpDifXIkmFDUwzI_hTJ55JcQ_ZARQAupwELgtjLEHHQZAeCs=s1600-w800"],"website":"http://ninewinecheese.com/","url":"https://maps.google.com/?cid=15407816978491618402","postal_code":"211-0025","user_ratings_total":80,"formatted_phone_number":"044-767-7129"},{"place_id":"ChIJMZv9Fnz1GGARKkQ75PN10Ps","name":"コブ","lat":35.5722461,"lng":139.6561641,"vicinity":"川崎市中原区今井南町２１−２６","rating":3.6,"price_level":nil,"photos":["https://lh3.googleusercontent.com/places/ANXAkqE0zksdKtqxDyYDffBE0oljUpG6x7Jq6sSDtG3MPlTWtiiwiZvSy3lsE72hTP6TNS2lJY1WB7_1WmA7UF_km13lEjE6cnXD1uE=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGURj57hTpEqqRpE8u4IilvOOmyAvmHaXRi5WUBbBLrXCGFbfza_m7vlUu9Z592V4n54X-ZNX_5HSsnDytgNR7jjAIITJFZOyc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGy24O5q1-2SNVzqoYQUDJDacqtfDMXQbG4VioiBr4NxF9yY1kx6FpKJV5v0eKwpYeD0GeXstovB-GNtxPfZwOkadqzj83JhHQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEABbwNqf7R3Kb4njvXw5c3y-8_QyWwnzkba6t4oBJqRznyRggPZVOIy84_jHoruV9eRjaYLGxQmY_JZKt4R4BAaX8YYUFK8XA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFjGN3RHa0hUAbWVo7xAy6PVuI3QcY-vywbhluNbL-a39kSQGrPTAXMMXONJZfC0m0_PHJiASgp6bQzs6Gt_C-dlOeJseCBzOQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGfP736Os6yTow94EL4-k4z6Kae1TQc7ynJNrGb9gCXRvX8Lgz9KT3P5vIQTL2fTCcUtA8tqCLyIYr-UqnBoqqSyHDFze04VPs=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFnD6Z4ana73JHvH-giJLn5SCeY2YGhUM616AgQj_2Gqzvmq1mldRrYfN2fVLqqNHp-Rr8u_vP9fNDl2yuKaRL5us-I4uU4mAc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFq_O76UyyAc6EEKGATbQBS7uZxbvaDVyK1LM6ffwZoVdc1oyAhjRBUpsjUtvm0o0v7DNAbfHNV9dnJU5zbGizULSjgPKPkKlI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqH_mtF8ciJIUeFV6RIQN3XNRJ86fcC4TFZ8I1kERJN96WiUEcB_GUmeoHx-cUUHIVkCVtrQ1KGbz9_Ml-lMsrEpKP9pCenxc8E=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFTPR0cyV3k7GTkfDZVRxAl5dAGODK2YO6qb7LGSu6tKRw4Tyj6dbT3_k6UfyRFxKKXvuLFOItMoOa-T4SmNIStC2skIv_54hk=s1600-w800"],"website":"https://pizzaandwine-kobu.gorp.jp/","url":"https://maps.google.com/?cid=18145132589042320426","postal_code":"211-0064","user_ratings_total":58,"formatted_phone_number":"044-722-6008"},{"place_id":"ChIJiUp6HXz1GGARX-TUmpgh9uA","name":"イタリア家庭料理AZZURRO","lat":35.5722652,"lng":139.6557031,"vicinity":"川崎市中原区今井南町１９−７ フローラル松野","rating":3.8,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqFY_qwyFRKKUR3Iuwsh0BDc0vWRoZrpwCd_gmCxU3Q08aQg-oztmjG-w6-PyjLfwMLNOdQDa9Hx7zpmLawgzl9I9KZWU58ZpYc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFpGm03ucXwskBcT8q1GzxI2r8KhGdfqOqx3_dduoYyv7RKIsyoALgGuVox-y6hV0mUjjlaPdy37rJ2y0QdXxxufrl6J4AgUSo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEDklkKd3B26Y6lzwJLtCjA0aSA_fnzg_IyxZFOyt9C75F06UHeLNFG2Pc5jMehEAsP3zvS3-p8DuxE1rikEYCETBRfLwoxqPc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEDlL1lYJxdN5F2GsNcBcyaePhObKpv5Fs-xcln9a6589C1RFoDi4JToyJW-rNR8gqCRtQ3cPpfdimWXlC9GYqSL6o_WQD9lJw=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFXHgEiBXog8IxMihqTZOwUcprNx038xtQv6ZHegcL3vOHdOnigGYISxx4R9g7HEbYEFueQFBZnuCkZj6uUH3rhE2Qp9ObiuwI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqElgjlLsF5q1iQgTYaniC7icziOauKaXXBqDagyLCxJsfIZTSL01D4HvMjbGlGV5M9DUrr8Orgy-HfgXdM3j8Xv_0NCDjuwfSE=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF39AClqK6nJYzbbV7jQsk2LrY76gLxV8X7cpoT3o_iTgeCE2ribCENCXdKXDMimvS-BgnngijTDujB48bjVeXsKAurtbO_2Hw=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHhCgHNUwRTd2nYRby3qseeRUIfmTIQf_6_foyv56Qz5RaCCI-edJ5MAg2hZxtO8rt9Jjlfh0k7oIWsZ8Cx0ECGeFs0zycNoAA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqExyfITVe3rCBmb15AWi_nLpKGs6MnmqX__GtY4_A8d46qGqBlM370DDiGDqJje70GNJw3TEMaWEOx-pyaty5KZ5GiUY5STrGQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGIfelXxffT_IVCy7RAsrz5X26hzbFoTQUpjSVLJZqPtHp7grOghVXCqLDUYraf9WjI5z3eW2vgHHqgAndbZsrsl8RA2qDhbCk=s1600-w800"],"website":"https://www.instagram.com/2006azzurro","url":"https://maps.google.com/?cid=16210180848083067999","postal_code":"211-0064","user_ratings_total":31,"formatted_phone_number":"044-733-3319"},{"place_id":"ChIJjQRvZZn1GGARISOwoON10ow","name":"ビストロ カリネ","lat":35.57208190000001,"lng":139.6593813,"vicinity":"川崎市中原区市ノ坪１３２","rating":4.2,"price_level":nil,"photos":["https://lh3.googleusercontent.com/places/ANXAkqF9dPQ08ntHBgQghEjoO25zsbdru8zQAtxb9PEKGDjLcflxpbf8xJOa65q9UVdweMPmGI6Epa4ROOinAQJjAyjMnoUZYJcQMKU=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHa3oLIR72nTn2Jq9Nr8lhej58aEpteaG6xhcC0Mp1Zibrqo2mMyBiMLTPCspLQh8_gcLWAp2805UgVA_1svSsfYoSnq-KZChc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFJ1VNCaQA6yxafkVG4PMIiU1WFMj8EEhk7MA7XU_8VVztgTG2bBUMMBTYni5OZ4gqkLVn0Z0LIZQ7LDTABZWAD6ic_uedu6aM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFuNZLjWi5IOdLhEoJF2eJR5ZXwJISRQuPc03GhZHHZ7d3ps-uB2o4Q0cTmJR1KEc4glPajBPrhEgZW92F5zUt9FbyFGnQ21OY=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqElUJSe4Ww6oZ6G-sA-1fgF7NLA8dg2rPLMpJwyT7cP41Hgu1RUwKU4W379NfP000K7gmGm0JJDSI_iM4hPImK3wurD-1pFFY0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGuKRMx_8zRHm4C-1miwPl8oh3X7cIi7kFE9yyekP2UkwCgKV8YYosh9vvQbNOGsVL61KwtqiIUX5AqdVp01sECgK7tp7IS0Hw=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqETSF0rouN865m8Bz0qAKC8T70kPVhqTIidTQom6ze9Ly0zXMjXFTYV5yjojGNRp6kUCvghZFI40uJWOFgUsUf8ndoW-HE_E4s=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGnOsJmTycn-YJDUr31LzVSM3RGZpaQQJgfNe_Apd-znC6PLitCBgBCbO_i4IrxEIyEn0_toqmM6X_q-FM0uyGcFjXGiVdWV50=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEwbAJ1hSShAb1HkBe6NR7d2Ln_kdc8btmzRLTWoWPNf-G4KAMs50BOlfy-Zi_svUYXTG1v__SRPap8ayRBbKuQtL0w9do05rE=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFo982ry_pImTfxsStutP1qbzUkCSN6iMb2p9hCh82avD0CUoslMuMyRZ-LsVsgItxtV0NVy6GaJW_ZRar8ZIxWT2oByhn0mRM=s1600-w800"],"website":"https://tabelog.com/kanagawa/A1405/A140504/14074738/","url":"https://maps.google.com/?cid=10147302530933072673","postal_code":"211-0016","user_ratings_total":89,"formatted_phone_number":"044-863-9982"},{"place_id":"ChIJVYh63Xz1GGARQ8pPKpSlXmI","name":"イタリアン クレフ 武蔵小杉店","lat":35.5722708,"lng":139.659793,"vicinity":"川崎市中原区市ノ坪１２８−１ Prima SK 武蔵小杉2F","rating":4.1,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqEq-a_BJ6dAZX9F8gXDN0yK3F9Z8liCyqDH5uicCKi8zVKPxY-rDqD7APEMTltsC4jLehf5ueAVr_wiNd3Fx2-hXqWnBZWfmak=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHY86c4wOTgBGlrn9kkl-jcWvLOUgbikWiI9pYl9RRarlceIaI86EsMvfyCSDHC0-fNYreP7-qhwQnfiibGpyOcXAShOPrfC0s=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFhLmXe9gmp653I5d-I250-067pyKfW7JmBDdXPOWSD_R9deJcJOYO_X6QID-6Gr2g07EMVWI6IpYVmIXdOcyxXQ-2H8oAfZTw=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGaFRUtOm0BWIy7FELxob9YOvwYq3Rl6p9g7gDX3ivHN4tqxx-1I4b93zsBnbCi4OiyzqvidPyZVw6QbTV1AWdIb_32NbwhiFI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFm3Y23F_Q6uJBNqGafyzJiebONNVB3UaZQA8G9wB0WG0VaReLxpNRj3jT7dblI9gfpvjws3qHmyL9PdN0q7rZKP6-YE5wGCU0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGlS1a2w71NDWvVFs_noP5xkJjjvYUifu3ziIPLZvUNr6WuYtjvuXOO-8zvwQZ1KGR7nhJOrGVRMELp1FIJtqx5RmGyEGx9OCw=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGWgnmtXXiPtjTg7HiBSuuZtpx_J9Dxqlf7q0PjGQHA_YnRpaEnQTorqZtv3d7C4pvFdZURGLbWAzEhI40HcrhKzVBZMq4eTlk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHE22c775BIT_eghoZCcqSzZZ82pKRgVn_HhvAXVRqda4C3ZbyzWEFyaxVvg-4sNFxUo09IpFfPSJUebqc1_m5WmcInlb5BjuI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGLpOAPeceIlnTMQdZQTlFKc-Z0r_IGOe5c4rGrDZ7lfO3BTdhzGCqcSZHrfzzmYg5PoGH8iqmxUpwUjqqFyJvczptVY3rYUTc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqE9TP4-IYRiE9Utqi26dfK7Qh4E73B1gIG7DkvOzEbkiMCItADyXdsH7wxqd_xlAM8JOkuxLpKI7MsfweBvtVmIjbtrvRN9BjY=s1600-w800"],"website":"https://tabelog.com/kanagawa/A1405/A140504/14059181/","url":"https://maps.google.com/?cid=7088284919311354435","postal_code":"211-0016","user_ratings_total":78,"formatted_phone_number":"044-948-6423"},{"place_id":"ChIJBVkAMYFfGGARo8PMa_jzSuY","name":"サイゼリヤ 元住吉駅前店","lat":35.5648727,"lng":139.6548986,"vicinity":"川崎市中原区木月２丁目３−３５ 住吉名店ｾﾝﾀ B1F","rating":3.6,"price_level":1,"photos":["https://lh3.googleusercontent.com/places/ANXAkqHuBreSW4uHfiakFNJyHDHd1cTd88Omc-snPhHYsu1VMkS1C74edkLnK-3AVP9-RZ6Y6dTq1Ts3ITSJo80_7dFIK3JXDh4lEQQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGJKIZrqolatY0oMWTJJSuB2EU0mPNrxkeN497ZCAYgKpE4QNTQN0vPeWZ0CUrvq1EuJ_mREgGxE2aarlC1RJJB6HVS2k_0qAg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEgzCFUGqyQ1U7pe84W1md3mPivdcPgab6KeHgWerA22hOxkFaQkgpDM4KPLclshGZXA9dcDsRm9owNCqjQw1b5U6yEQyUgBQ=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFjzRtZMwbU1ei3CeNPYjhStpL4d_E4w-vKKfNJanaxK2c6kERWhbk5rgHr_KIi8l4ISaOrRM0L8iNS9UTNwhJB2UKbyIjK4pI=s1600-w720","https://lh3.googleusercontent.com/places/ANXAkqEj3KM9FXT_Ox7eeuWovQWxD7n-B8VR-QOOE0KxpTbhvYDwwToxgWvewQ4zw6PudGnKxWuLPZAz3EpwG1j9CsxbGBtGN5KgFjA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFreet1A8e-Cxd24v4k1_uhgOxTdAhWiniLKLGIF0LEqhKQaIfX1PoQsoB_DQY3ScWC02jP5ogGX5ta0cTaiTEIDrYiHE03MVk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqG5tFtZtuUCFl_MPn3K6C-00nS0Vrh48J7Rz1327aasATOeG7VY3Dc3PceUSQHOWQ1_6nEA3UTwv4T6zeTVE3mN0NzOB8_MAM8=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFU9Pwt7t56B6z7C9Sl089skEzD6SxMrX2l1ETUuKoin9J2Kk7cGAIEjG3hRmVhpAJ_Qq5P4yYdwyegQxLfUwD_c_zmzRfAtTo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEs4vqvZBNfVmj615x9s4Dt2ROmLyd1v5nk97MK1XkuP-mlFclwmbbc7idmcvAxtdiDptbatTU_J73oY1JX-ye_cJv-n9zwglg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHKzMXJNM1CNR_tFOc1F_Iktij5gWH-adT93Td53XW85VmV6xfltNaSB72WL38j5zjy7eU9YmvzyHpcGzFaKUePpMGxtL2Ktio=s1600-w800"],"website":"https://shop.saizeriya.co.jp/sz_restaurant/spot/detail?code=1106","url":"https://maps.google.com/?cid=16594344025286034339","postal_code":"211-0025","user_ratings_total":429,"formatted_phone_number":"044-431-3202"},{"place_id":"ChIJdW84J331GGAR3gmnMZNaps4","name":"武蔵小杉 わいん処 さんぐり家","lat":35.5720279,"lng":139.6596174,"vicinity":"川崎市中原区市ノ坪１３１−５ SOARS ２F","rating":4.3,"price_level":nil,"photos":["https://lh3.googleusercontent.com/places/ANXAkqFEuTe7O1kuHKgwynbj4cp2wSjYTsxwW2dsY6uefWXJn4h3k7i67oBh0rIWYZ485Nk6_uyCLvt5pzS_7XaAib3OWcaAZinVRmI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHGp-BnYNdRNVeN8hbT3DI_JWtnp7HTTmgdhfyqHB1zfv0qHcEnVuryLcEwEtzdrVPU1R_ekWrH8tAzBXlnr3BcxqDABfvJV6g=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF1VTLsHuwKvs4sMXggNyJ0SsO7v9YmFwes8Z4K9FlIW-BNMpUP33uNbML8x8fxcx4tzubk8Kl55dZvN2F7stN2lKlzISIpzSc=s1600-w413","https://lh3.googleusercontent.com/places/ANXAkqE_jJd69swHNAT0BZ1uK3IX-g5gvfKvnOG6NNsJI7CqkQcugLie-NEgaSORC4OwANuHrgWEH8hWSBiSJBzPf2rlqdXOd617bpk=s1600-w413","https://lh3.googleusercontent.com/places/ANXAkqF3hCAREIAkrwNI4qF5-i-LXWKsB8cR9BWbV2Q9-r-ToO5w97Laql96pUyn5wpKrFCdFX8b2GD-Oe-kk9hPmjwqhPlKLnniId0=s1600-w413","https://lh3.googleusercontent.com/places/ANXAkqGOgxxWwXI91BpXqSJHrglL1aYp9a8IcJUZIH_dpVozTZnhYVtm0vqbwM3Pqje7xQ-cvGMMZcFDNvFrqUYkd1K9txYTvSE5Z1w=s1600-w413","https://lh3.googleusercontent.com/places/ANXAkqHu9A0KuwnSsUPcbf_5V5pjokTSfE21sozqT3PPaXenDXNwVY62MgjnKcXu6WheRRafIn-DpDHgFyALOxpXPPUo3W1yhSRT0So=s1600-w413","https://lh3.googleusercontent.com/places/ANXAkqGytUwy4602bGRzvXIMw1GOCp3Xaf4R95_nN7dHznwY3cKEeT80OMWM_FVS-VORJb7NXnazanJaQS47J7Ou69jtaBJXCGQekWw=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFtWEf5ZE4304ku7csTDPzz7uhQYk_LAfni_WZU_SSEYTPhOJV9XAtbu7G7b2JLF6_s05enW9ssMjmKr6oGimtYVX90HrY4MCc=s1600-w413","https://lh3.googleusercontent.com/places/ANXAkqHmxMTdyYObRv7vjtEMCB56f4SzvoBR4cIIXi9Qg4Sc6-ZItHUjSyG82prYMPKnBw_ULk-lwuOwU9lQTG7cdAFDy1FyrWIyTuU=s1600-w800"],"website":"http://sangriya.owst.jp/","url":"https://maps.google.com/?cid=14890688806186846686","postal_code":"211-0016","user_ratings_total":112,"formatted_phone_number":"044-863-8955"},{"place_id":"ChIJdVTEf4RfGGARXODvL0s333Q","name":"自在屋","lat":35.5612982,"lng":139.6555436,"vicinity":"川崎市中原区木月４丁目１０−６","rating":4.4,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqGwyL1pVwXVh3Rq_1eaJH4TNoeqRecK6LKj1be3oTEgA0Gq1Jzrv9Kf-VWhv1Sj_9CTU0NQ7UnBB9nW1XjEPOAPUeCtkN9LZN0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFwkvjSFDvWIPKWxHqNB59jTluUtR2qUkRimseEOHKSW19BeqoDoJc6NSk-Qin8yowvWjXQ_l1Wt0aYaFEQdl6U98Msed8MaSo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHFSL1JdpX3rUtRZTSuMl2aoN4KejbyponKw4UaS7K0mz45vp43IV-MBK55kJnitZCFGCINDxqLcpcST9mNKQQQ-BJsNf2PxqU=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEOAxo6kIEEmXn-F-ANVA08pdZwoluoRkSsvVAuhxX1HYnorBb6d5Zqo1Zo4-Z6eSxYBDJOyUsQTgM8wY0NKttwCqkbKziX6cA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGmjKjbCwyZz9ArY9w0GRRRm-sBtgywULuS8dzzed4QlZZeHzYe8ie9RYgvmhKpPWR6Hk7P5kHwD10m1tvvLalr4HIC1oX59g=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGQB_CSfrLdtaEYT2ih9HuFYd2kHy789c8b-qCdpMXRmAyaYLbuFwbnNY8AJoW7yQidF_9ymh0ZearFv4jJ2F3I5Ppk9rBbeys=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFkV9SELoLakZj-DbQh_wK7wu3GVBSA1n-VMyGxBHET5BaW50jUgx9bs2zcGXwY7Mmbnv7J1fD_1_7incEqZJBv3ZiVTwLi_dU=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFQrl4CwdDxeX652zY93BJSvdaSJDV8p5chx8NjUhernWurhjgZybP4oPDa8c1e1QgAKvYJjnp7G3YB8Mpt7FKFGjkGkeycgWk=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqG0K7hldvMyS2HrIHW6DiWH4ohwBTNzPQdyz9nYn45lmApPSTgBChJE_PBpgg7fCRlLz1NBIonK-M0vC5WWXltCH1rVGjejE08=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF10jVYkBljxfnjo8GydNrNrDSa1_G-fLUJzOd-gOhjNdEMsvPZA5WliADlOiByAXctuiuc3YnJfG4WOtXoo-gn4zKpSumi_R4=s1600-w800"],"website":nil,"url":"https://maps.google.com/?cid=8421510624272441436","postal_code":"211-0025","user_ratings_total":93,"formatted_phone_number":"044-433-5644"},{"place_id":"ChIJpwRjNoFfGGAR7oN-Al909jU","name":"牡蠣とワインと魚と肉と。 元住吉にて","lat":35.5645946,"lng":139.6550493,"vicinity":"川崎市中原区木月２丁目５−１２","rating":4.1,"price_level":nil,"photos":["https://lh3.googleusercontent.com/places/ANXAkqGaUpyhplL32R5D6rmnz3TBM6n2BsEPB7GDodX6ELSOvlvNnFZLeZO_dpMQzj3V-2DA5purkui4BrfnyXH3i25OWSVPAafFL-0=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGGVHQQ2PyLwrvSXlAK9DTnQMQ6dvbZHho8eftv2vYcJHFG-b-qV6ZsEsqsDJ7VRbkeyzF0BU0Pk2PPB7QecD15vsAZfiHc-3I=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqG3mKKM23mWmQqFvTEGYdi0HmyRwuaQ0U2f8nAc_IAhLaNTHXvsK_g-zvP_AECOkADF1kqP_T8bcGNxCKCAFNNRF1Cswx6PjMg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGKCq3-kJYahItWjfat-fgE_o07Pp5qRkkwDrVYrYY1zh560ib7tA12ICpmgqQKTmpbSWrV61CGYopkpHKiY2IATTUPqazOebY=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFqed0zuVIFtZ390akeePoGxsBMWzfTZoXDjvBXs05NhaE8GxV0hfoi3AtRfIHHmtcPxraxqyryiDRxBaz-3nPNcs1k2Oh7btI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGYs3XPfCwcHRc3SJsTdOzHNUrm3C4TpHNpySWQjXt8NPcGdcuHUL7-Gbu0lDw7iaNfbLodaYcf-DrL1Y8NhSdpME1sdxOQtyo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGhpdqh6lU3tLBBJ6sCI7RXv2jkDIKNMOeAtD1Qtaztd7S18_ou2my2kNZKoLfkoC7Dd8v_bsC5l-Whna4R7lr0j2wDDCvgCjA=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEltrfytJrDK2VgqLAKo9FhnqiNbyjpbVHB3UGUjlouRBRflXjwEaLkggU19Psg4ZB7ajlqYNMqH0gFIkZXrPmc8Zi7ILgKxNI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHC47XI9GkF6TZHcVJuKhVCL-s9CGFVSV6K3o5NwSOIZmwfSRH9OrH8BmrdfXvZJTVrXKNBdbvUKBYD_cmHo1IfE_ai6ASVeVM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGbQGucEmKvAtTJsaVHrz7luYmDgDDR5APH1dzefJLDp3nXETse6s07c12xJ-wpjmxtvUhxEK8s4D4c8QECcCOlfNk2NdW3vFA=s1600-w800"],"website":"https://www.hotpepper.jp/strJ001192063/yoyaku/","url":"https://maps.google.com/?cid=3888423279693562862","postal_code":"211-0025","user_ratings_total":124,"formatted_phone_number":"044-433-9480"},{"place_id":"ChIJ61N__4FfGGARxJi_txWk8OU","name":"ドミノ・ピザ木月住吉店","lat":35.565432,"lng":139.658455,"vicinity":"川崎市中原区木月住吉町３２−１","rating":3.3,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqE98Yy3-XRXrzZ8VU3PZCgJ3bJCJj5xDHoo22UMsF19Tb6dLBSD5QjA9169i7BwzvHVyAKMbIvBxTsVTCnH2mEPDAlhLTjQzso=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFCudTbVlJP6sZla_Bpq-CtzjRNooyiMwo51VAes8A9POfo1NYl95r3YhROv6CKVuMn46iQ7bzVUL1Io7gVmZWL7AmRoOxgICM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGzz3auU2VVlGL7DIiXw1N8VI6XpXMKn4OQguKz8zYM2JWDRG8ZvuYq_bOlue3qxl3yXhoFyfDdLQeaNqgTjF56ridqBCNnWWo=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGLOn35ES40mbbhnP4V0g_1ODTrvtFbyJ66ADAP8hM2XRknAj_FDCM1BKaMhBz-zqshKi0xE5jDj-8BotQIzF68K2WLIUckOmc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGjUIF8YtUv_RYHoV--e4KV29D9OLVmcNUALzra1khhXSBnW0BVtmPQ2_v17gBSjjomh35A16a6qlURn2fhp5_C0-cwJe_tpAs=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF6J5vUNz9cgXXci-34RPX5_XL4NvHQYWPiN3gDQ6F_YZubHnAKiCZfuyheYSvcKpDkqWy5eD8Unuot46O6yNy8UrZNM16XLH4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFoG155qwy_FwgkTJbcTq3UEajD66HL1IV74cEhMoT72rq23nsCbMXpnuzyRTDPzjsxkwc6GIWDs0M32Kb5cEI3l7nmOySrrYE=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFVaIK2RpIkh2tEDW8x2Vnz7oVktaQ4wO3IVj18L1yYYvNZVHINmssSIlJnl4pGTFaFC9ntALwxbCNEAzrYrhuJ8gBfED353sY=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGeIAX1yLikCdUEVo8hamdfv4qAhCcYcOYn8eKpKKJKgnnWie13KFaObf75NXbvEKt2p1jYDKVGn3zZaJRBgq3b3TfKF8PK0qE=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqF5xfvf68mBNRmOB48fhqkERAHB5UfoJKWl2YE_aX_nK_-E9p92q3tlMKUhh8dAVRgfaVqCznst4D3cCgZEi020NhNnK88nxLg=s1600-w800"],"website":"https://www.dominos.jp/store/86929?utm_source=Google\u0026utm_medium=local\u0026utm_campaign=yext\u0026utm_content=86929","url":"https://maps.google.com/?cid=16568923442280110276","postal_code":"211-0021","user_ratings_total":100,"formatted_phone_number":"044-422-5959"},{"place_id":"ChIJQcqyhXv1GGARDXPprC-_GD4","name":"PUBLIC HOUSE 武蔵小杉店","lat":35.5741536,"lng":139.658866,"vicinity":"川崎市中原区小杉町３丁目４４６−４","rating":3.8,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqFL-tY8CAXANSQJG9XnzwL3ISTnV2d9xkkkUhHVAr6Aab4HlOevI7AXdy31_UQd1yxn9ddK_Fu6Cv5mfuNJHounfTv80yt1Vas=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqH0q5SsaL1JiB_WFnV-4lPOT6fuM_OO92v_IGutlg6wCktY_so90ORYZzXbrazGhHDfvviVaTBS8pyzL7kyKQaMJWDA6iaPiwc=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFpknQ6p46hncv3eGIX_PxmN0GfMod4hxoMOXgmihzifQouOM0LSzApjRcIA8bPsiAx9zS9VHTnUW6j_mgBEDup48IRYkgb1MI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHRiHQpaEV7919YNOa20ojxe2UQpqRFQgOs8xRjdhz5-qyb62SNcKHz5wWSqXbh-F0iUycU3u45UKcBepthtmmf99jm4SK307g=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGUghU1qsrJBfHuqFh6oLd-2p1ZRbXL59_q29yKmdR-0l6s4usjUxRstqhe4eyiBoOSac4rtlkFTRAE08vSgX66iOi8R7da1Gs=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFYlVDJJghgCkJxqOugjkwXxtjxSrSN_wv3R1Kjc0y6e_6Efj--GOHUV1-DiyLmwaeTf9kT9e1p_OoMQHKULs_6O2Qp-Q2RW6c=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGb6Qckr7fAVvXLzvb7q2oClRVI8byQLsgF6_6rZOZe0uUXBJ4MlnGFho6lPx_bX8gYwD--PuldJEd9i692q0b-Cs0wJPXDLxs=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFyLjVHr_ebgJvyzCX1NUrbA0Re2R0XPW5zQg2FzOb7-uJVVxU7qMU58VHhYGJbjQWCcGp1YrNm5Iw9xe2ba05M7Me27cBFx9U=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFqxzvSjlqZSNiFXBIwGuw9GMRIVwQZZQHl--LRA2OLQ7br06LvrZxjExJW6T3a7hc717db3jiQr-8tW4jSLNQIItx7birWO8k=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGMBc-9Ex7ZbrPNN_YhkHhd0C9jrHO2KUEVwppLkPWvgBUyM_-0x3WlGcEgn_7QjxC-3HwI3noRZEy-qWgyfYhHnCxkztTeFpU=s1600-w800"],"website":"https://www.cafecompany.co.jp/brands/publichouse/#shop2","url":"https://maps.google.com/?cid=4474536441277936397","postal_code":"211-0063","user_ratings_total":470,"formatted_phone_number":"044-739-2660"},{"place_id":"ChIJIYfI29_1GGARo-UQrX_J6Ts","name":"生パスタ専門店 pastastand Kino（パスタスタンドキーノ）","lat":35.5741451,"lng":139.6530298,"vicinity":"川崎市中原区今井南町５−３３ パレスイトウビル","rating":4.3,"price_level":2,"photos":["https://lh3.googleusercontent.com/places/ANXAkqGdNF3wfFU1bGcD9fvm5-OdgWRfTqfoa065K3N5-96_umu-nRA4_APvYZHBTYZSHVsBBLQ1dAvFwshxDXE2u6_V4ZYE_Rdwors=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFOr6e6AUitviwQRKdzBaqJ1d6B6bgTmytgkGxEzAVqUil04vhxDyXYc6wpcB5X0kFuvFsedZgysNcJeBjXFQ-K8tRZJ4Loqz4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHPLQpmNEv3Ces3WcfBrD0G3uij3cfiPiBo85J4LXxrgI4aSTsjXrQpQ-93MbEKYWzV1n6FrAbvXg4nnU1R9o2o4NQ0azgbL1g=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHmifH1ve8JPwysAxrBhyMdyMseA8aaGihkOGYbFuXGAIA0rnykZfybq7GIN3mMWo847NPqbUTEyuEdKdL28gM-ZgPlcwWwfmg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqHlV7yhqT2mHP3B224PSq1on_aZPez9BAy0OyWBvUjIshW653WeWpVLR2baEglLtFPaq7dYaInjhBEiYCpXER6QCFf-lagmGmI=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFqBIlhV00e-9WAs-C_M9QDwEkb-BSCVAfkSrX4FxemH-YS-qX_oKuiyPdKURUILwUGUBEXen_dRVHfuWwqyzZ-b0wXQZgesrg=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqFgdzL_LTP2M90GGJ-_y-lSTzSUo1HxQdzdYskpQTxrADtjE_fawQFsAg9mePxOS9gy8nZXGNCd_uajr9nHOeX6CtTRUpm9VKM=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqEmey8ibXK2VgYIApejhI3zmLqqISNM2Ycve-LFnGOryVMXDLhX6Aajs2HKl_ycLqaGZ72Ba3bnc7586qQyI51Pe28tY2JLH-Y=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGkO8kWu6MgF-W0ioCw_H9EkJPAy_PKjccGrFZi3Q42Qrxluagv8vuMy0Wp0Wn52IRkmh6eOxQGRnIcGEixarfS3HtvGq73sk4=s1600-w800","https://lh3.googleusercontent.com/places/ANXAkqGNsRskbs-X1D5hjghfNBpykw-B-kTAO-vGI3shJdqTFYJyOxnjvMBrmcqxRV9L4OoBfVcoUsgjrfHSINcGkdcqlOHSSlTrrio=s1600-w800"],"website":"https://www.pastastand-kino.com/","url":"https://maps.google.com/?cid=4317203268012926371","postal_code":"211-0064","user_ratings_total":33,"formatted_phone_number":nil}]
    # processed_restaurants = sort_restaurants(processed_restaurants)

    render json: { status: 200, message: processed_restaurants }
  end
  
  private

  def set_google_places_client
    @client = GooglePlaces::Client.new(ENV['GOOGLE_API_KEY'])
  end

  def fetch_restaurants_from_google
    begin
      restaurants = @client.spots(
        params[:latitude], params[:longitude],
        name: params[:category],
        radius: params[:radius],
        types: 'restaurant',
        language: 'ja'
      )

      raise "レストランが見つかりません。検索条件を変更して再度お試しください。" if restaurants.blank?

      restaurants

      rescue GooglePlaces::OverQueryLimitError
        raise "クエリ上限に達しました。"
      rescue GooglePlaces::RequestDeniedError
        raise "リクエストが拒否されました。"
      rescue GooglePlaces::InvalidRequestError
        raise "無効なリクエストです。"
      rescue GooglePlaces::NotFoundError
        raise "該当する結果が見つかりません。"
      rescue GooglePlaces::UnknownError
        raise "未知のエラーが発生しました。"
      rescue => e
        raise "予期しないエラーが発生しました：#{e.message}"
    end
  end

  def distance_in_meters(lat1, lng1, lat2, lng2)
    rad_per_deg = Math::PI / 180
    r = 6371 * 1000 # Earth radius in meters
    dlat_rad = (lat2 - lat1) * rad_per_deg
    dlng_rad = (lng2 - lng1) * rad_per_deg
  
    a = Math.sin(dlat_rad / 2)**2 + Math.cos(lat1 * rad_per_deg) * Math.cos(lat2 * rad_per_deg) * Math.sin(dlng_rad / 2)**2
    (2 * r * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))).to_i
  end

  def process_restaurant_data(restaurants)
    restaurants.map do |restaurant|
      details = get_restaurant_details(restaurant)
      {
        place_id:    restaurant.place_id,
        name:        restaurant.name,
        lat:         restaurant.lat,
        lng:         restaurant.lng,
        vicinity:    restaurant.vicinity,
        rating:      restaurant.rating,
        price_level: restaurant.price_level,
        photos:      details[:photos],
        website:     details[:website],
        url:         details[:url],
        postal_code: details[:postal_code],
        user_ratings_total: details[:user_ratings_total],
        formatted_phone_number: details[:formatted_phone_number]
      }
    end
  end

  def get_restaurant_details(restaurant)
    existing_details = Restaurant.find_by(place_id: restaurant.place_id)
  
    return format_existing_details(existing_details) if existing_details

    new_details = @client.spot(restaurant.place_id)

    if new_details.present?
      details = format_new_details(new_details)
      SaveRestaurantJob.perform_later(details)
      details[:photos] = new_details.photos.map { |photo| "https://maps.googleapis.com/maps/api/place/photo?maxwidth=580&photoreference=#{photo.photo_reference}&key=#{ENV['GOOGLE_API_KEY']}" }
      details
    end
  end

  def format_existing_details(details)
    {
      photos: details.photos.order(:position).pluck(:url),
      website: details.website,
      url: details.url,
      postal_code: details.postal_code,
      user_ratings_total: details.user_ratings_total,
      formatted_phone_number: details.formatted_phone_number
    }
  end

  def format_new_details(details)
    {
      place_id: details.place_id,
      name: details.name,
      lat: details.lat,
      lng: details.lng,
      vicinity: details.vicinity,
      rating: details.rating,
      price_level: details.price_level,
      photos: details.photos.map(&:photo_reference),
      website: details.website,
      url: details.url,
      postal_code: details.postal_code,
      user_ratings_total: details.json_result_object["user_ratings_total"],
      formatted_phone_number: details.formatted_phone_number
    }
  end

  def sort_restaurants(restaurants)
    case params[:sort]
    when 'prominence'
      restaurants
    when 'distance'
      restaurants.sort_by { |restaurant| Math.sqrt((restaurant[:lat] - params[:latitude].to_f)**2 + (restaurant[:lng] - params[:longitude].to_f)**2) }
    when 'highPrice'
      restaurants.sort_by { |restaurant| -restaurant[:price_level].to_i }
    when 'lowPrice'
      restaurants.sort_by { |restaurant| restaurant[:price_level].to_i }
    when 'highRating'
      restaurants.sort_by { |restaurant| -restaurant[:rating].to_f }
    else
      restaurants
    end
  end

  def render_error(status, message)
    status_mapping = {
      too_many_requests: 429,
      forbidden: 403,
      bad_request: 400,
      not_found: 404,
      internal_server_error: 500
    }
    render json: { error: message }, status: status_mapping[status] || status
  end
end